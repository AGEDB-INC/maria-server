--- debug_innodb_fail.result
+++ debug_innodb_fail,subpartition.reject
@@ -18,7 +18,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -26,10 +26,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -39,6 +43,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -61,10 +67,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -74,6 +84,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -92,7 +104,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -100,10 +112,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -113,6 +129,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -136,10 +154,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -149,6 +171,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -170,7 +194,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -178,10 +202,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -191,6 +219,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -213,10 +243,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -226,6 +260,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -244,7 +280,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -252,10 +288,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -265,6 +305,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -288,10 +330,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -301,6 +347,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -322,7 +370,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -330,10 +378,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_3: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -343,6 +395,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -365,10 +419,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -378,6 +436,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -396,7 +456,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -404,10 +464,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_3: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -417,6 +481,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -440,10 +506,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -453,6 +523,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -474,7 +546,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -482,10 +554,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_4: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -495,6 +571,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -517,10 +595,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -530,6 +612,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -548,7 +632,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -556,10 +640,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_4: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -569,6 +657,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -592,10 +682,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -605,6 +699,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -626,7 +722,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -634,10 +730,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_5: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -647,6 +747,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -669,10 +771,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -682,6 +788,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -700,7 +808,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -708,10 +816,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_5: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -721,6 +833,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -744,10 +858,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -757,6 +875,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -778,7 +898,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -786,10 +906,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_6: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -799,6 +923,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -821,10 +947,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -834,6 +964,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -852,7 +984,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -860,10 +992,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_6: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -873,6 +1009,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -896,10 +1034,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -909,6 +1051,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -930,7 +1074,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -938,10 +1082,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_7: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -951,6 +1099,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -973,10 +1123,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -986,6 +1140,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1004,7 +1160,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1012,10 +1168,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_7: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1025,6 +1185,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1048,10 +1210,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1061,6 +1227,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1082,7 +1250,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1090,10 +1258,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_8: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1103,6 +1275,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1125,10 +1299,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1138,6 +1316,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1156,7 +1336,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1164,10 +1344,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_8: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1177,6 +1361,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1200,10 +1386,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1213,6 +1403,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1234,7 +1426,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1242,10 +1434,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1255,6 +1451,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1277,10 +1475,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1290,6 +1492,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1309,7 +1513,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1317,10 +1521,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1330,6 +1538,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1353,10 +1563,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1366,6 +1580,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1387,7 +1603,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1395,10 +1611,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1408,6 +1628,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1430,10 +1652,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1443,6 +1669,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1462,7 +1690,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1470,10 +1698,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1483,6 +1715,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1506,10 +1740,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1519,6 +1757,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1542,7 +1782,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1550,10 +1790,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1563,6 +1807,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1584,10 +1830,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1597,6 +1847,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1615,7 +1867,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1623,10 +1875,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1636,6 +1892,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1658,10 +1916,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1671,6 +1933,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1692,7 +1956,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1700,10 +1964,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1713,6 +1981,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1734,10 +2004,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1747,6 +2021,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1765,7 +2041,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1773,10 +2049,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1786,6 +2066,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1808,10 +2090,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1821,6 +2107,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1842,7 +2130,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1850,10 +2138,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_3: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1863,6 +2155,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1884,10 +2178,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1897,6 +2195,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1915,7 +2215,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1923,10 +2223,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_3: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1936,6 +2240,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1958,10 +2264,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1971,6 +2281,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1992,7 +2304,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2000,10 +2312,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_4: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2013,6 +2329,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2034,10 +2352,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2047,6 +2369,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2065,7 +2389,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2073,10 +2397,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_4: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2086,6 +2414,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2108,10 +2438,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2121,6 +2455,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2142,7 +2478,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2150,10 +2486,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_5: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2163,6 +2503,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2184,10 +2526,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2197,6 +2543,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2215,7 +2563,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2223,10 +2571,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_5: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2236,6 +2588,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2258,10 +2612,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2271,6 +2629,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2292,7 +2652,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2300,10 +2660,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_6: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2313,6 +2677,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2334,10 +2700,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2347,6 +2717,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2365,7 +2737,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2373,10 +2745,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_6: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2386,6 +2762,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2408,10 +2786,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2421,6 +2803,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2442,7 +2826,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2450,10 +2834,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_7: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2463,6 +2851,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2484,10 +2874,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2497,6 +2891,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2515,7 +2911,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2523,10 +2919,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_7: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2536,6 +2936,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2558,10 +2960,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2571,6 +2977,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2592,7 +3000,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2600,10 +3008,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_8: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2613,6 +3025,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2634,10 +3048,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2647,6 +3065,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2665,7 +3085,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2673,10 +3093,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_8: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2686,6 +3110,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2708,10 +3134,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2721,6 +3151,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2742,7 +3174,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2750,10 +3182,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2763,6 +3199,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2784,10 +3222,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2797,6 +3239,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2816,7 +3260,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2824,10 +3268,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2837,6 +3285,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2859,10 +3309,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2872,6 +3326,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2893,7 +3349,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2901,10 +3357,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2914,6 +3374,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2935,10 +3397,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2948,6 +3414,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2967,7 +3435,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2975,10 +3443,14 @@
 INSERT INTO t1 VALUES (1, "Original from partition p0"), (2, "Original from partition p0"), (3, "Original from partition p0"), (4, "Original from partition p0"), (11, "Original from partition p1"), (12, "Original from partition p1"), (13, "Original from partition p1"), (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2988,6 +3460,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3010,10 +3484,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3023,6 +3501,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
