--- debug_innodb_fail.result
+++ debug_innodb_fail,subpartition.reject
@@ -19,7 +19,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -35,10 +35,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -48,6 +52,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -70,10 +76,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -83,6 +93,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -101,7 +113,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -117,10 +129,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -130,6 +146,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -153,10 +171,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -166,6 +188,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -188,7 +212,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -204,10 +228,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -217,6 +245,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -239,10 +269,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -252,6 +286,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -270,7 +306,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -286,10 +322,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -299,6 +339,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -322,10 +364,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -335,6 +381,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -357,7 +405,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -373,10 +421,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_3: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -386,6 +438,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -408,10 +462,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -421,6 +479,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -439,7 +499,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -455,10 +515,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_3: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -468,6 +532,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -491,10 +557,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -504,6 +574,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -526,7 +598,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -542,10 +614,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_4: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -555,6 +631,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -577,10 +655,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -590,6 +672,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -608,7 +692,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -624,10 +708,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_4: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -637,6 +725,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -660,10 +750,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -673,6 +767,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -695,7 +791,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -711,10 +807,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_5: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -724,6 +824,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -746,10 +848,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -759,6 +865,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -777,7 +885,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -793,10 +901,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_5: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -806,6 +918,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -829,10 +943,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -842,6 +960,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -864,7 +984,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -880,10 +1000,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_6: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -893,6 +1017,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -915,10 +1041,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -928,6 +1058,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -946,7 +1078,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -962,10 +1094,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_6: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -975,6 +1111,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -998,10 +1136,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1011,6 +1153,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1033,7 +1177,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1049,10 +1193,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_7: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1062,6 +1210,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1084,10 +1234,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1097,6 +1251,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1115,7 +1271,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1131,10 +1287,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_7: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1144,6 +1304,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1167,10 +1329,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1180,6 +1346,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1202,7 +1370,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1218,10 +1386,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_8: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1231,6 +1403,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1253,10 +1427,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1266,6 +1444,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1284,7 +1464,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1300,10 +1480,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_add_partition_8: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1313,6 +1497,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1336,10 +1522,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1349,6 +1539,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1371,7 +1563,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1387,10 +1579,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1400,6 +1596,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1422,10 +1620,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1435,6 +1637,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1454,7 +1658,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1470,10 +1674,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1483,6 +1691,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1506,10 +1716,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1519,6 +1733,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1541,7 +1757,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1557,10 +1773,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1570,6 +1790,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1592,10 +1814,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1605,6 +1831,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1624,7 +1852,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1640,10 +1868,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1653,6 +1885,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1676,10 +1910,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1689,6 +1927,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1713,7 +1953,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1729,10 +1969,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1742,6 +1986,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1763,10 +2009,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1776,6 +2026,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1794,7 +2046,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1810,10 +2062,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1823,6 +2079,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1845,10 +2103,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1858,6 +2120,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1880,7 +2144,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1896,10 +2160,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1909,6 +2177,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1930,10 +2200,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1943,6 +2217,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1961,7 +2237,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1977,10 +2253,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1990,6 +2270,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2012,10 +2294,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2025,6 +2311,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2047,7 +2335,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2063,10 +2351,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_3: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2076,6 +2368,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2097,10 +2391,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2110,6 +2408,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2128,7 +2428,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2144,10 +2444,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_3: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2157,6 +2461,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2179,10 +2485,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2192,6 +2502,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2214,7 +2526,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2230,10 +2542,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_4: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2243,6 +2559,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2264,10 +2582,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2277,6 +2599,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2295,7 +2619,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2311,10 +2635,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_4: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2324,6 +2652,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2346,10 +2676,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2359,6 +2693,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2381,7 +2717,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2397,10 +2733,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_5: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2410,6 +2750,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2431,10 +2773,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2444,6 +2790,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2462,7 +2810,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2478,10 +2826,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_5: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2491,6 +2843,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2513,10 +2867,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2526,6 +2884,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2548,7 +2908,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2564,10 +2924,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_6: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2577,6 +2941,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2598,10 +2964,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2611,6 +2981,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2629,7 +3001,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2645,10 +3017,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_6: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2658,6 +3034,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2680,10 +3058,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2693,6 +3075,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2715,7 +3099,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2731,10 +3115,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_7: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2744,6 +3132,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2765,10 +3155,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2778,6 +3172,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2796,7 +3192,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2812,10 +3208,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_7: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2825,6 +3225,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2847,10 +3249,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2860,6 +3266,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2882,7 +3290,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2898,10 +3306,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_8: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2911,6 +3323,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2932,10 +3346,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2945,6 +3363,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2963,7 +3383,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2979,10 +3399,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_drop_partition_8: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2992,6 +3416,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3014,10 +3440,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3027,6 +3457,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3049,7 +3481,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3065,10 +3497,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3078,6 +3514,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3099,10 +3537,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3112,6 +3554,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3131,7 +3575,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3147,10 +3591,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3160,6 +3608,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3182,10 +3632,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3195,6 +3649,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3217,7 +3673,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3233,10 +3689,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3246,6 +3706,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3267,10 +3729,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3280,6 +3746,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3299,7 +3767,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3315,10 +3783,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3328,6 +3800,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3350,10 +3824,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3363,6 +3841,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3387,7 +3867,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3403,10 +3883,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3416,6 +3900,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3440,10 +3926,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3453,6 +3943,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3471,7 +3963,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3487,10 +3979,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3500,6 +3996,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3525,10 +4023,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3538,6 +4040,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3560,7 +4064,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3576,10 +4080,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3589,6 +4097,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3613,10 +4123,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3626,6 +4140,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3644,7 +4160,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3660,10 +4176,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3673,6 +4193,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3698,10 +4220,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3711,6 +4237,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3733,7 +4261,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3749,10 +4277,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_3: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3762,6 +4294,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3786,10 +4320,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3799,6 +4337,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3817,7 +4357,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3833,10 +4373,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_3: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3846,6 +4390,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3871,10 +4417,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3884,6 +4434,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3906,7 +4458,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3922,10 +4474,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_add_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3935,6 +4491,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3959,10 +4517,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3972,6 +4534,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3990,7 +4554,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4006,10 +4570,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_add_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4019,6 +4587,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4044,10 +4614,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4057,6 +4631,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4079,7 +4655,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4095,10 +4671,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_add_parts_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4108,6 +4688,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4133,10 +4715,14 @@
 Error	1105	Unknown error
 Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4146,6 +4732,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4164,7 +4752,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4180,10 +4768,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_add_parts_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4193,6 +4785,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4219,10 +4813,14 @@
 Error	1105	Unknown error
 Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4232,6 +4830,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4254,7 +4854,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4270,10 +4870,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_add_parts_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4283,6 +4887,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4308,10 +4914,14 @@
 Error	1105	Unknown error
 Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4321,6 +4931,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4339,7 +4951,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4355,10 +4967,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_add_parts_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4368,6 +4984,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4394,10 +5012,14 @@
 Error	1105	Unknown error
 Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4407,6 +5029,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4429,7 +5053,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4445,10 +5069,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_add_parts_3: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4458,6 +5086,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4483,10 +5113,14 @@
 Error	1105	Unknown error
 Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4496,6 +5130,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4514,7 +5150,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4530,10 +5166,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_add_parts_3: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4543,6 +5183,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4569,10 +5211,14 @@
 Error	1105	Unknown error
 Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4582,6 +5228,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4604,7 +5252,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4620,10 +5268,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_4: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4633,6 +5285,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4657,10 +5311,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4670,6 +5328,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4688,7 +5348,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4704,10 +5364,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_4: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4717,6 +5381,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4742,10 +5408,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4755,6 +5425,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4777,7 +5449,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4793,10 +5465,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_5: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4806,6 +5482,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4830,10 +5508,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4843,6 +5525,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4861,7 +5545,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4877,10 +5561,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_5: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4890,6 +5578,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4915,10 +5605,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4928,6 +5622,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4950,7 +5646,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4966,10 +5662,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_rename_to_backup: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4979,6 +5679,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5003,10 +5705,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5016,6 +5722,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5034,7 +5742,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -5050,10 +5758,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_rename_to_backup: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5063,6 +5775,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5088,10 +5802,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5101,6 +5819,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5123,7 +5843,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -5139,10 +5859,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_rename_parts_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5152,6 +5876,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5176,10 +5902,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5189,6 +5919,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5207,7 +5939,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -5223,10 +5955,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_rename_parts_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5236,6 +5972,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5261,10 +5999,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5274,6 +6016,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5296,7 +6040,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -5312,10 +6056,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_rename_added_part: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5325,6 +6073,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5349,10 +6099,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5362,6 +6116,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5380,7 +6136,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -5396,10 +6152,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_rename_added_part: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5409,6 +6169,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5434,10 +6196,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5447,6 +6213,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5469,7 +6237,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -5485,10 +6253,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_rename_parts_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5498,6 +6270,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5522,10 +6296,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5535,6 +6313,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5553,7 +6333,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -5569,10 +6349,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_rename_parts_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5582,6 +6366,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5607,10 +6393,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5620,6 +6410,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5642,7 +6434,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -5658,10 +6450,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_rename_drop_backup: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5671,6 +6467,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5695,10 +6493,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5708,6 +6510,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5726,7 +6530,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -5742,10 +6546,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_rename_drop_backup: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5755,6 +6563,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5780,10 +6590,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5793,6 +6607,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5815,7 +6631,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -5831,10 +6647,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_6: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5844,6 +6664,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5868,10 +6690,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5881,6 +6707,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5899,7 +6727,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -5915,10 +6743,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_6: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5928,6 +6760,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5953,10 +6787,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5966,6 +6804,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5988,7 +6828,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -6004,10 +6844,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_7: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6017,6 +6861,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6041,10 +6887,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6054,6 +6904,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6072,7 +6924,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -6088,10 +6940,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_7: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6101,6 +6957,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6126,10 +6984,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6139,6 +7001,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6161,7 +7025,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -6177,10 +7041,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_8: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6190,6 +7058,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6214,10 +7084,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6227,6 +7101,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6245,7 +7121,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -6261,10 +7137,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_8: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6274,6 +7154,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6299,10 +7181,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6312,6 +7198,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6334,7 +7222,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -6350,10 +7238,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_9: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6363,6 +7255,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6387,10 +7281,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6400,6 +7298,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6418,7 +7318,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -6434,10 +7334,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_change_partition_9: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6447,6 +7351,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6472,10 +7378,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6485,6 +7395,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6507,7 +7419,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -6523,10 +7435,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6536,6 +7452,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6560,10 +7478,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6573,6 +7495,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6592,7 +7516,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -6608,10 +7532,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6621,6 +7549,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6646,10 +7576,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6659,6 +7593,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6681,7 +7617,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -6697,10 +7633,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6710,6 +7650,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6734,10 +7676,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6747,6 +7693,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6766,7 +7714,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -6782,10 +7730,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure (under LOCK TABLE)
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6795,6 +7747,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6820,10 +7774,14 @@
 Level	Code	Message
 Error	1105	Unknown error
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -6833,6 +7791,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -6840,6386 +7800,6 @@
 SELECT * FROM t1;
 a	b
 1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Iterating 21 fail-points
-set @save_dbug= @@debug_dbug;
-# Fail-point 1: fail_change_partition_1
-set @@debug_dbug= "+d,fail_change_partition_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_1: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_1: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_1: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_1: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 2: fail_change_partition_2
-set @@debug_dbug= "+d,fail_change_partition_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_2: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_2: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_2: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_2: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 3: fail_change_partition_3
-set @@debug_dbug= "+d,fail_change_partition_3";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_3: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_3: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_3: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_3: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 4: fail_alter_partition_add_1
-set @@debug_dbug= "+d,fail_alter_partition_add_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_add_1: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_add_1: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_add_1: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_add_1: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 5: fail_change_partition_add_parts_1
-set @@debug_dbug= "+d,fail_change_partition_add_parts_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_1: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_1: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_1: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_1: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 6: fail_change_partition_add_parts_2
-set @@debug_dbug= "+d,fail_change_partition_add_parts_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_2: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_2: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_2: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_2: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 7: fail_change_partition_add_parts_3
-set @@debug_dbug= "+d,fail_change_partition_add_parts_3";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_3: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_3: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_3: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_3: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 8: fail_change_partition_4
-set @@debug_dbug= "+d,fail_change_partition_4";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_4: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_4: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_4: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_4: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 9: fail_change_partition_5
-set @@debug_dbug= "+d,fail_change_partition_5";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_5: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_5: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_5: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_5: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 10: fail_alter_partition_rename_to_backup
-set @@debug_dbug= "+d,fail_alter_partition_rename_to_backup";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_to_backup: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_to_backup: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_to_backup: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_to_backup: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 11: fail_change_partition_rename_parts_1
-set @@debug_dbug= "+d,fail_change_partition_rename_parts_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_rename_parts_1: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_rename_parts_1: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_rename_parts_1: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_rename_parts_1: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 12: fail_alter_partition_rename_added_part
-set @@debug_dbug= "+d,fail_alter_partition_rename_added_part";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_added_part: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_added_part: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_added_part: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_added_part: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 13: fail_change_partition_rename_parts_2
-set @@debug_dbug= "+d,fail_change_partition_rename_parts_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_rename_parts_2: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_rename_parts_2: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_rename_parts_2: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_rename_parts_2: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 14: fail_alter_partition_rename_drop_backup
-set @@debug_dbug= "+d,fail_alter_partition_rename_drop_backup";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_drop_backup: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_drop_backup: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_drop_backup: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_drop_backup: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 15: fail_change_partition_6
-set @@debug_dbug= "+d,fail_change_partition_6";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_6: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_6: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_6: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_6: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 16: fail_change_partition_7
-set @@debug_dbug= "+d,fail_change_partition_7";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_7: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_7: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_7: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_7: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 17: fail_change_partition_8
-set @@debug_dbug= "+d,fail_change_partition_8";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_8: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_8: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_8: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_8: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 18: fail_change_partition_9
-set @@debug_dbug= "+d,fail_change_partition_9";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_9: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_9: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_9: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_9: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 19: fail_alter_partition_binlog_1
-set @@debug_dbug= "+d,fail_alter_partition_binlog_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_binlog_1: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER,InnoDB,1,test,t1,id: 1,InnoDB,1,test,t1,id: 2
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_binlog_1: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 20: fail_alter_partition_binlog_2
-set @@debug_dbug= "+d,fail_alter_partition_binlog_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_binlog_2: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER,InnoDB,1,test,t1,id: 1,InnoDB,1,test,t1,id: 2
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_binlog_2: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Iterating 21 fail-points
-set @save_dbug= @@debug_dbug;
-# Fail-point 1: fail_change_partition_1
-set @@debug_dbug= "+d,fail_change_partition_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_1: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_1: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_1: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_1: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 2: fail_change_partition_2
-set @@debug_dbug= "+d,fail_change_partition_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_2: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_2: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_2: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_2: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 3: fail_change_partition_3
-set @@debug_dbug= "+d,fail_change_partition_3";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_3: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_3: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_3: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_3: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 4: fail_alter_partition_add_1
-set @@debug_dbug= "+d,fail_alter_partition_add_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_add_1: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_add_1: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_add_1: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_add_1: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 5: fail_change_partition_add_parts_1
-set @@debug_dbug= "+d,fail_change_partition_add_parts_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_1: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_1: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_1: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_1: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 6: fail_change_partition_add_parts_2
-set @@debug_dbug= "+d,fail_change_partition_add_parts_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_2: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_2: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_2: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_2: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 7: fail_change_partition_add_parts_3
-set @@debug_dbug= "+d,fail_change_partition_add_parts_3";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_3: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_3: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_add_parts_3: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_add_parts_3: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-Error	1030	Got error 0 "Internal error/check (Not system error)" from storage engine InnoDB
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 8: fail_change_partition_4
-set @@debug_dbug= "+d,fail_change_partition_4";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_4: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_4: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_4: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_4: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 9: fail_change_partition_5
-set @@debug_dbug= "+d,fail_change_partition_5";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_5: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_5: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_5: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_5: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 10: fail_alter_partition_rename_to_backup
-set @@debug_dbug= "+d,fail_alter_partition_rename_to_backup";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_to_backup: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_to_backup: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_to_backup: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_to_backup: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 11: fail_change_partition_rename_parts_1
-set @@debug_dbug= "+d,fail_change_partition_rename_parts_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_rename_parts_1: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_rename_parts_1: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_rename_parts_1: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_rename_parts_1: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 12: fail_alter_partition_rename_added_part
-set @@debug_dbug= "+d,fail_alter_partition_rename_added_part";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_added_part: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_added_part: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_added_part: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_added_part: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 13: fail_change_partition_rename_parts_2
-set @@debug_dbug= "+d,fail_change_partition_rename_parts_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_rename_parts_2: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_rename_parts_2: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_rename_parts_2: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_rename_parts_2: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 14: fail_alter_partition_rename_drop_backup
-set @@debug_dbug= "+d,fail_alter_partition_rename_drop_backup";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_drop_backup: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_drop_backup: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_rename_drop_backup: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_rename_drop_backup: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 15: fail_change_partition_6
-set @@debug_dbug= "+d,fail_change_partition_6";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_6: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_6: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_6: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_6: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 16: fail_change_partition_7
-set @@debug_dbug= "+d,fail_change_partition_7";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_7: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_7: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_7: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_7: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 17: fail_change_partition_8
-set @@debug_dbug= "+d,fail_change_partition_8";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_8: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_8: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_8: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_8: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 18: fail_change_partition_9
-set @@debug_dbug= "+d,fail_change_partition_9";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_9: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_9: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_change_partition_9: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_change_partition_9: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 19: fail_alter_partition_binlog_1
-set @@debug_dbug= "+d,fail_alter_partition_binlog_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_binlog_1: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER,InnoDB,1,test,t1,id: 1,InnoDB,1,test,t1,id: 2
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_binlog_1: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_binlog_1: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-UNLOCK TABLES;
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Fail-point 20: fail_alter_partition_binlog_2
-set @@debug_dbug= "+d,fail_alter_partition_binlog_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_binlog_2: AFTER failure
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER,InnoDB,1,test,t1,id: 1,InnoDB,1,test,t1,id: 2
-DROP TABLE t1;
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,ddl_log,fail_alter_partition_binlog_2: BEFORE failure (under LOCK TABLE)
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-LOCK TABLE t1 WRITE;
-ALTER TABLE t1 COALESCE PARTITION 2;
-ERROR HY000: Unknown error
-# d,ddl_log,fail_alter_partition_binlog_2: AFTER failure (under LOCK TABLE)
-show warnings;
-Level	Code	Message
-Error	1105	Unknown error
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
 11	Original from partition p1
 12	Original from partition p1
 13	Original from partition p1
