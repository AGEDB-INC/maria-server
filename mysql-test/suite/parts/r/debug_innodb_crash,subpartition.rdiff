--- debug_innodb_crash.result
+++ debug_innodb_crash,subpartition.reject
@@ -19,7 +19,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -35,10 +35,14 @@
 (14, "Original from partition p1");
 # d,ddl_log,crash_add_partition_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -48,6 +52,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -66,18 +72,26 @@
 (PARTITION p15 VALUES IN (20,21,22,23,24));
 # d,ddl_log,crash_add_partition_1: AFTER crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,ddl_log,crash_add_partition_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -87,6 +101,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -108,7 +124,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -124,10 +140,14 @@
 (14, "Original from partition p1");
 # d,crash_add_partition_2: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -137,6 +157,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -157,18 +179,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_add_partition_2: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -178,6 +208,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -199,7 +231,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -215,10 +247,14 @@
 (14, "Original from partition p1");
 # d,crash_add_partition_3: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -228,6 +264,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -248,18 +286,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_add_partition_3: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -269,6 +315,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -290,7 +338,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -306,10 +354,14 @@
 (14, "Original from partition p1");
 # d,crash_add_partition_4: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -319,6 +371,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -339,19 +393,28 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_add_partition_4: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -361,6 +424,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -382,7 +447,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -398,10 +463,14 @@
 (14, "Original from partition p1");
 # d,crash_add_partition_5: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -411,6 +480,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -431,19 +502,28 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_add_partition_5: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -453,6 +533,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -474,7 +556,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -490,10 +572,14 @@
 (14, "Original from partition p1");
 # d,crash_add_partition_6: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -503,6 +589,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -523,19 +611,28 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_add_partition_6: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -545,6 +642,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -566,7 +665,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -582,10 +681,14 @@
 (14, "Original from partition p1");
 # d,crash_add_partition_7: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -595,6 +698,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -617,17 +722,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 # d,crash_add_partition_7: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -637,6 +751,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -658,7 +774,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -674,10 +790,14 @@
 (14, "Original from partition p1");
 # d,crash_add_partition_8: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -687,6 +807,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -707,19 +829,28 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_add_partition_8: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -729,6 +860,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -750,7 +883,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -766,10 +899,14 @@
 (14, "Original from partition p1");
 # d,crash_alter_partition_binlog_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -779,6 +916,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -799,19 +938,28 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_alter_partition_binlog_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -821,6 +969,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -842,7 +992,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -858,10 +1008,14 @@
 (14, "Original from partition p1");
 # d,crash_alter_partition_binlog_2: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -871,6 +1025,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -891,19 +1047,28 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_alter_partition_binlog_2: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -913,6 +1078,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -934,7 +1101,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -950,10 +1117,14 @@
 (14, "Original from partition p1");
 # d,crash_done_partition_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -963,6 +1134,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -983,20 +1156,30 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_done_partition_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1006,6 +1189,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1030,7 +1215,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1046,10 +1231,14 @@
 (14, "Original from partition p1");
 # d,crash_done_partition_2: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1059,6 +1248,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1079,20 +1270,30 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_done_partition_2: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1102,6 +1303,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1126,7 +1329,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1142,10 +1345,14 @@
 (14, "Original from partition p1");
 # d,crash_fail_partition_1,fail_add_partition_5: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1155,6 +1362,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1175,19 +1384,28 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_fail_partition_1,fail_add_partition_5: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1197,6 +1415,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1218,7 +1438,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1234,10 +1454,14 @@
 (14, "Original from partition p1");
 # d,crash_fail_partition_2,fail_add_partition_5: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1247,6 +1471,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1267,19 +1493,28 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_fail_partition_2,fail_add_partition_5: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1289,6 +1524,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1312,7 +1549,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1328,10 +1565,14 @@
 (14, "Original from partition p1");
 # d,crash_drop_partition_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1341,6 +1582,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1358,18 +1601,26 @@
 ALTER TABLE t1 DROP PARTITION p10, p20;
 # d,crash_drop_partition_1: AFTER crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_drop_partition_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1379,6 +1630,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1400,7 +1653,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1416,10 +1669,14 @@
 (14, "Original from partition p1");
 # d,crash_drop_partition_2: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1429,6 +1686,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1448,18 +1707,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_drop_partition_2: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1469,6 +1736,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1490,7 +1759,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1506,10 +1775,14 @@
 (14, "Original from partition p1");
 # d,crash_drop_partition_3: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1519,6 +1792,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1538,18 +1813,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_drop_partition_3: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1559,6 +1842,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1580,7 +1865,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1596,10 +1881,14 @@
 (14, "Original from partition p1");
 # d,crash_drop_partition_4: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1609,6 +1898,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1628,18 +1919,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_drop_partition_4: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1649,6 +1948,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1670,7 +1971,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1686,10 +1987,14 @@
 (14, "Original from partition p1");
 # d,crash_drop_partition_5: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1699,6 +2004,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1718,18 +2025,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_drop_partition_5: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1739,6 +2054,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1760,7 +2077,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1776,10 +2093,14 @@
 (14, "Original from partition p1");
 # d,crash_drop_partition_6: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1789,6 +2110,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1808,18 +2131,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_drop_partition_6: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1829,6 +2160,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1850,7 +2183,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1866,10 +2199,14 @@
 (14, "Original from partition p1");
 # d,crash_drop_partition_7: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1879,6 +2216,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1900,16 +2239,24 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 # d,crash_drop_partition_7: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1919,6 +2266,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1940,7 +2289,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -1956,10 +2305,14 @@
 (14, "Original from partition p1");
 # d,crash_drop_partition_8: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -1969,6 +2322,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -1988,18 +2343,26 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_drop_partition_8: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2009,6 +2372,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2030,7 +2395,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2046,10 +2411,14 @@
 (14, "Original from partition p1");
 # d,crash_alter_partition_binlog_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2059,6 +2428,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2078,18 +2449,26 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_alter_partition_binlog_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2099,6 +2478,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2120,7 +2501,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2136,10 +2517,14 @@
 (14, "Original from partition p1");
 # d,crash_alter_partition_binlog_2: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2149,6 +2534,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2168,18 +2555,26 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_alter_partition_binlog_2: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2189,6 +2584,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2210,7 +2607,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2226,10 +2623,14 @@
 (14, "Original from partition p1");
 # d,crash_done_partition_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2239,6 +2640,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2258,16 +2661,22 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_done_partition_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2277,6 +2686,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
 SELECT * FROM t1;
@@ -2293,7 +2704,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2309,10 +2720,14 @@
 (14, "Original from partition p1");
 # d,crash_done_partition_2: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2322,6 +2737,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2341,16 +2758,22 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_done_partition_2: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2360,6 +2783,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
 SELECT * FROM t1;
@@ -2376,7 +2801,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2392,10 +2817,14 @@
 (14, "Original from partition p1");
 # d,crash_fail_partition_1,fail_drop_partition_5: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2405,6 +2834,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2424,18 +2855,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_fail_partition_1,fail_drop_partition_5: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2445,6 +2884,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2466,7 +2907,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2482,10 +2923,14 @@
 (14, "Original from partition p1");
 # d,crash_fail_partition_2,fail_drop_partition_5: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2495,6 +2940,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2514,18 +2961,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_fail_partition_2,fail_drop_partition_5: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2535,6 +2990,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2558,7 +3015,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2574,10 +3031,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2587,6 +3048,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2607,18 +3070,26 @@
 PARTITION p25 VALUES IN (24,25,26,27,28,29,30));
 # d,crash_change_partition_1: AFTER crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2628,6 +3099,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2649,7 +3122,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2665,10 +3138,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_2: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2678,6 +3155,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2700,18 +3179,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_2: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2721,6 +3208,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2742,7 +3231,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2758,10 +3247,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_3: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2771,6 +3264,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2793,18 +3288,26 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_3: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2814,6 +3317,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2835,7 +3340,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2851,10 +3356,14 @@
 (14, "Original from partition p1");
 # d,crash_alter_partition_add_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2864,6 +3373,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2886,19 +3397,27 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#TMP#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_alter_partition_add_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2908,6 +3427,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2929,7 +3450,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -2945,10 +3466,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_add_parts_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -2958,6 +3483,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -2980,21 +3507,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p15#TMP#.ibd
-t1#P#p20.ibd
-t1#P#p25#TMP#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#TMP#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#TMP#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0#TMP#.ibd
+t1#P#p15#SP#p15sp1#TMP#.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p25#SP#p25sp0#TMP#.ibd
+t1#P#p25#SP#p25sp1#TMP#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_add_parts_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3004,6 +3542,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3025,7 +3565,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3041,10 +3581,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_add_parts_2: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3054,6 +3598,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3076,21 +3622,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p15#TMP#.ibd
-t1#P#p20.ibd
-t1#P#p25#TMP#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#TMP#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#TMP#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0#TMP#.ibd
+t1#P#p15#SP#p15sp1#TMP#.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p25#SP#p25sp0#TMP#.ibd
+t1#P#p25#SP#p25sp1#TMP#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_add_parts_2: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3100,6 +3657,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3121,7 +3680,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3137,10 +3696,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_add_parts_3: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3150,6 +3713,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3172,21 +3737,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p15#TMP#.ibd
-t1#P#p20.ibd
-t1#P#p25#TMP#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#TMP#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#TMP#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0#TMP#.ibd
+t1#P#p15#SP#p15sp1#TMP#.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p25#SP#p25sp0#TMP#.ibd
+t1#P#p25#SP#p25sp1#TMP#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_add_parts_3: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3196,6 +3772,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3217,7 +3795,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3233,10 +3811,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_4: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3246,6 +3828,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3268,21 +3852,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p15#TMP#.ibd
-t1#P#p20.ibd
-t1#P#p25#TMP#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#TMP#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#TMP#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0#TMP#.ibd
+t1#P#p15#SP#p15sp1#TMP#.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p25#SP#p25sp0#TMP#.ibd
+t1#P#p25#SP#p25sp1#TMP#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_4: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3292,6 +3887,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3313,7 +3910,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3329,10 +3926,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_5: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3342,6 +3943,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3364,21 +3967,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p15#TMP#.ibd
-t1#P#p20.ibd
-t1#P#p25#TMP#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#TMP#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#TMP#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0#TMP#.ibd
+t1#P#p15#SP#p15sp1#TMP#.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p25#SP#p25sp0#TMP#.ibd
+t1#P#p25#SP#p25sp1#TMP#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_5: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3388,6 +4002,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3409,7 +4025,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3425,10 +4041,14 @@
 (14, "Original from partition p1");
 # d,crash_alter_partition_rename_to_backup: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3438,6 +4058,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3460,21 +4082,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p15#TMP#.ibd
-t1#P#p20.ibd
-t1#P#p25#TMP#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0#TMP#.ibd
+t1#P#p10#SP#p10sp1#TMP#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0#TMP#.ibd
+t1#P#p15#SP#p15sp1#TMP#.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p25#SP#p25sp0#TMP#.ibd
+t1#P#p25#SP#p25sp1#TMP#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_alter_partition_rename_to_backup: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3484,6 +4117,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3505,7 +4140,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3521,10 +4156,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_rename_parts_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3534,6 +4173,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3556,21 +4197,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p15#TMP#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25#TMP#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0#TMP#.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1#TMP#.ibd
+t1#P#p15#SP#p15sp0#TMP#.ibd
+t1#P#p15#SP#p15sp1#TMP#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0#TMP#.ibd
+t1#P#p25#SP#p25sp1#TMP#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_rename_parts_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3580,6 +4232,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3601,7 +4255,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3617,10 +4271,14 @@
 (14, "Original from partition p1");
 # d,crash_alter_partition_rename_added_part: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3630,6 +4288,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3652,21 +4312,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15#TMP#.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25#TMP#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1#TMP#.ibd
+t1#P#p15#SP#p15sp0#TMP#.ibd
+t1#P#p15#SP#p15sp1#TMP#.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0#TMP#.ibd
+t1#P#p25#SP#p25sp1#TMP#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_alter_partition_rename_added_part: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3676,6 +4347,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3697,7 +4370,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3713,10 +4386,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_rename_parts_2: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3726,6 +4403,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3748,21 +4427,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_rename_parts_2: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3772,6 +4462,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3793,7 +4485,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3809,10 +4501,14 @@
 (14, "Original from partition p1");
 # d,crash_alter_partition_rename_drop_backup: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3822,6 +4518,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3844,21 +4542,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_alter_partition_rename_drop_backup: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3868,6 +4577,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3889,7 +4600,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -3905,10 +4616,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_6: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3918,6 +4633,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3940,21 +4657,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_6: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -3964,6 +4692,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -3985,7 +4715,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4001,10 +4731,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_7: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4014,6 +4748,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4036,21 +4772,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_7: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4060,6 +4807,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4081,7 +4830,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4097,10 +4846,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_8: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4110,6 +4863,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4134,19 +4889,30 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 # d,crash_change_partition_8: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4156,6 +4922,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4177,7 +4945,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4193,10 +4961,14 @@
 (14, "Original from partition p1");
 # d,crash_change_partition_9: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4206,6 +4978,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4228,21 +5002,32 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_change_partition_9: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4252,6 +5037,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4273,7 +5060,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4289,10 +5076,14 @@
 (14, "Original from partition p1");
 # d,crash_alter_partition_binlog_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4302,6 +5093,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4324,21 +5117,32 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_alter_partition_binlog_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4348,6 +5152,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4369,7 +5175,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4385,10 +5191,14 @@
 (14, "Original from partition p1");
 # d,crash_alter_partition_binlog_2: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4398,6 +5208,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4420,21 +5232,32 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_alter_partition_binlog_2: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4444,6 +5267,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4465,7 +5290,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4481,10 +5306,14 @@
 (14, "Original from partition p1");
 # d,crash_done_partition_1: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4494,6 +5323,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4516,22 +5347,34 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_done_partition_1: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4541,6 +5384,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (10,11,12,13,14,15,16) ENGINE = InnoDB,
  PARTITION `p15` VALUES IN (17,18,19,20,21,22,23) ENGINE = InnoDB,
@@ -4567,7 +5412,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4583,10 +5428,14 @@
 (14, "Original from partition p1");
 # d,crash_done_partition_2: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4596,6 +5445,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4618,22 +5469,34 @@
 #sql-backup-4-t1.frm
 #sql-backup-4-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_done_partition_2: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4643,6 +5506,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (10,11,12,13,14,15,16) ENGINE = InnoDB,
  PARTITION `p15` VALUES IN (17,18,19,20,21,22,23) ENGINE = InnoDB,
@@ -4669,7 +5534,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4685,10 +5550,14 @@
 (14, "Original from partition p1");
 # d,crash_fail_partition_1,fail_change_partition_5: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4698,6 +5567,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4720,21 +5591,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p15#TMP#.ibd
-t1#P#p20.ibd
-t1#P#p25#TMP#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#TMP#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#TMP#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0#TMP#.ibd
+t1#P#p15#SP#p15sp1#TMP#.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p25#SP#p25sp0#TMP#.ibd
+t1#P#p25#SP#p25sp1#TMP#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_fail_partition_1,fail_change_partition_5: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4744,6 +5626,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4765,7 +5649,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4781,10 +5665,14 @@
 (14, "Original from partition p1");
 # d,crash_fail_partition_2,fail_change_partition_5: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4794,6 +5682,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4816,21 +5706,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p15#TMP#.ibd
-t1#P#p20.ibd
-t1#P#p25#TMP#.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#TMP#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#TMP#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0#TMP#.ibd
+t1#P#p15#SP#p15sp1#TMP#.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p25#SP#p25sp0#TMP#.ibd
+t1#P#p25#SP#p25sp1#TMP#.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_fail_partition_2,fail_change_partition_5: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4840,6 +5741,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4861,7 +5764,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4877,10 +5780,14 @@
 (14, "Original from partition p1");
 # d,crash_fail_partition_1,fail_change_partition_6: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4890,6 +5797,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4912,21 +5821,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_fail_partition_1,fail_change_partition_6: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4936,6 +5856,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -4957,7 +5879,7 @@
 RESET MASTER;
 CREATE TABLE t1 (a INT, b VARCHAR(64))
 ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
+PARTITION BY LIST (a) SUBPARTITION BY HASH(a) SUBPARTITIONS 2
 (PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
 PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
 PARTITION p20 VALUES IN (25,26,27,28,29),
@@ -4973,10 +5895,14 @@
 (14, "Original from partition p1");
 # d,crash_fail_partition_2,fail_change_partition_6: BEFORE crash
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -4986,6 +5912,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5008,21 +5936,32 @@
 #sql-shadow-t1.frm
 #sql-shadow-t1.par
 db.opt
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p15.ibd
-t1#P#p20#REN#.ibd
-t1#P#p25.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0#REN#.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1#REN#.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p15#SP#p15sp0.ibd
+t1#P#p15#SP#p15sp1.ibd
+t1#P#p20#SP#p20sp0#REN#.ibd
+t1#P#p20#SP#p20sp1#REN#.ibd
+t1#P#p25#SP#p25sp0.ibd
+t1#P#p25#SP#p25sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 # d,crash_fail_partition_2,fail_change_partition_6: AFTER recovery
 db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
+t1#P#p0#SP#p0sp0.ibd
+t1#P#p0#SP#p0sp1.ibd
+t1#P#p10#SP#p10sp0.ibd
+t1#P#p10#SP#p10sp1.ibd
+t1#P#p20#SP#p20sp0.ibd
+t1#P#p20#SP#p20sp1.ibd
+t1#P#p30#SP#p30sp0.ibd
+t1#P#p30#SP#p30sp1.ibd
 t1.frm
 t1.par
 SHOW CREATE TABLE t1;
@@ -5032,6 +5971,8 @@
   `b` varchar(64) DEFAULT NULL
 ) ENGINE=InnoDB DEFAULT CHARSET=latin1
  PARTITION BY LIST (`a`)
+SUBPARTITION BY HASH (`a`)
+SUBPARTITIONS 2
 (PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
  PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
  PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
@@ -5039,4616 +5980,6 @@
 SELECT * FROM t1;
 a	b
 1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Iterating 27 crash-points
-set @save_dbug= @@debug_dbug;
-# Crash-point 1: crash_change_partition_1
-set @@debug_dbug= "+d,crash_change_partition_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_1: AFTER crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 2: crash_change_partition_2
-set @@debug_dbug= "+d,crash_change_partition_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_2: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_2: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_2: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 3: crash_change_partition_3
-set @@debug_dbug= "+d,crash_change_partition_3";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_3: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_3: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_3: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 4: crash_alter_partition_add_1
-set @@debug_dbug= "+d,crash_alter_partition_add_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_add_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_alter_partition_add_1: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_add_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 5: crash_change_partition_add_parts_1
-set @@debug_dbug= "+d,crash_change_partition_add_parts_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_add_parts_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_add_parts_1: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_add_parts_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 6: crash_change_partition_add_parts_2
-set @@debug_dbug= "+d,crash_change_partition_add_parts_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_add_parts_2: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_add_parts_2: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_add_parts_2: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 7: crash_change_partition_add_parts_3
-set @@debug_dbug= "+d,crash_change_partition_add_parts_3";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_add_parts_3: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_add_parts_3: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_add_parts_3: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 8: crash_change_partition_4
-set @@debug_dbug= "+d,crash_change_partition_4";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_4: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_4: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_4: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 9: crash_change_partition_5
-set @@debug_dbug= "+d,crash_change_partition_5";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_5: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_5: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_5: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 10: crash_alter_partition_rename_to_backup
-set @@debug_dbug= "+d,crash_alter_partition_rename_to_backup";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_rename_to_backup: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_alter_partition_rename_to_backup: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0#TMP#.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_rename_to_backup: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 11: crash_change_partition_rename_parts_1
-set @@debug_dbug= "+d,crash_change_partition_rename_parts_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_rename_parts_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_rename_parts_1: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0#TMP#.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_rename_parts_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 12: crash_alter_partition_rename_added_part
-set @@debug_dbug= "+d,crash_alter_partition_rename_added_part";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_rename_added_part: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_alter_partition_rename_added_part: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_rename_added_part: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 13: crash_change_partition_rename_parts_2
-set @@debug_dbug= "+d,crash_change_partition_rename_parts_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_rename_parts_2: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_rename_parts_2: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_rename_parts_2: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 14: crash_alter_partition_rename_drop_backup
-set @@debug_dbug= "+d,crash_alter_partition_rename_drop_backup";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_rename_drop_backup: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_alter_partition_rename_drop_backup: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_rename_drop_backup: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 15: crash_change_partition_6
-set @@debug_dbug= "+d,crash_change_partition_6";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_6: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_6: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_6: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 16: crash_change_partition_7
-set @@debug_dbug= "+d,crash_change_partition_7";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_7: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_7: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_7: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 17: crash_change_partition_8
-set @@debug_dbug= "+d,crash_change_partition_8";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_8: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_8: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-# d,crash_change_partition_8: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 18: crash_change_partition_9
-set @@debug_dbug= "+d,crash_change_partition_9";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_9: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_change_partition_9: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_9: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 19: crash_alter_partition_binlog_1
-set @@debug_dbug= "+d,crash_alter_partition_binlog_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_binlog_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_alter_partition_binlog_1: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_binlog_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 20: crash_alter_partition_binlog_2
-set @@debug_dbug= "+d,crash_alter_partition_binlog_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_binlog_2: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_alter_partition_binlog_2: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_binlog_2: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 21: crash_done_partition_1
-set @@debug_dbug= "+d,crash_done_partition_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_done_partition_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_done_partition_1: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_done_partition_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-master-bin.000001	#	Query	#	#	use `test`; ALTER TABLE t1 REBUILD PARTITION p0, p10
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 22: crash_done_partition_2
-set @@debug_dbug= "+d,crash_done_partition_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_done_partition_2: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_done_partition_2: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_done_partition_2: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-master-bin.000001	#	Query	#	#	use `test`; ALTER TABLE t1 REBUILD PARTITION p0, p10
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 23: crash_fail_partition_1,fail_change_partition_5,
-set @@debug_dbug= "+d,crash_fail_partition_1,fail_change_partition_5,";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_fail_partition_1,fail_change_partition_5: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_fail_partition_1,fail_change_partition_5: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_fail_partition_1,fail_change_partition_5: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 24: crash_fail_partition_2,fail_change_partition_5,
-set @@debug_dbug= "+d,crash_fail_partition_2,fail_change_partition_5,";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_fail_partition_2,fail_change_partition_5: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_fail_partition_2,fail_change_partition_5: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p10#TMP#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_fail_partition_2,fail_change_partition_5: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 25: crash_fail_partition_1,fail_change_partition_6,
-set @@debug_dbug= "+d,crash_fail_partition_1,fail_change_partition_6,";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_fail_partition_1,fail_change_partition_6: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_fail_partition_1,fail_change_partition_6: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_fail_partition_1,fail_change_partition_6: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 26: crash_fail_partition_2,fail_change_partition_6,
-set @@debug_dbug= "+d,crash_fail_partition_2,fail_change_partition_6,";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY LIST (a)
-(PARTITION p0 VALUES IN (0,1,2,3,4,5,6,7,8,9),
-PARTITION p10 VALUES IN (11,12,13,14,15,16,17,18,19),
-PARTITION p20 VALUES IN (25,26,27,28,29),
-PARTITION p30 VALUES IN (31,32,33,34,35,36,37,38,39));
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_fail_partition_2,fail_change_partition_6: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 REBUILD PARTITION p0, p10;
-# d,crash_fail_partition_2,fail_change_partition_6: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p10#REN#.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-# d,crash_fail_partition_2,fail_change_partition_6: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p10.ibd
-t1#P#p20.ibd
-t1#P#p30.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY LIST (`a`)
-(PARTITION `p0` VALUES IN (0,1,2,3,4,5,6,7,8,9) ENGINE = InnoDB,
- PARTITION `p10` VALUES IN (11,12,13,14,15,16,17,18,19) ENGINE = InnoDB,
- PARTITION `p20` VALUES IN (25,26,27,28,29) ENGINE = InnoDB,
- PARTITION `p30` VALUES IN (31,32,33,34,35,36,37,38,39) ENGINE = InnoDB)
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Iterating 27 crash-points
-set @save_dbug= @@debug_dbug;
-# Crash-point 1: crash_change_partition_1
-set @@debug_dbug= "+d,crash_change_partition_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_1: AFTER crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 2: crash_change_partition_2
-set @@debug_dbug= "+d,crash_change_partition_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_2: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_2: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_2: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 3: crash_change_partition_3
-set @@debug_dbug= "+d,crash_change_partition_3";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_3: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_3: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_3: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 4: crash_alter_partition_add_1
-set @@debug_dbug= "+d,crash_alter_partition_add_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_add_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_alter_partition_add_1: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_add_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 5: crash_change_partition_add_parts_1
-set @@debug_dbug= "+d,crash_change_partition_add_parts_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_add_parts_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_add_parts_1: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p1#TMP#.ibd
-t1#P#p1.ibd
-t1#P#p2#TMP#.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_add_parts_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 6: crash_change_partition_add_parts_2
-set @@debug_dbug= "+d,crash_change_partition_add_parts_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_add_parts_2: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_add_parts_2: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p1#TMP#.ibd
-t1#P#p1.ibd
-t1#P#p2#TMP#.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_add_parts_2: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 7: crash_change_partition_add_parts_3
-set @@debug_dbug= "+d,crash_change_partition_add_parts_3";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_add_parts_3: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_add_parts_3: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p1#TMP#.ibd
-t1#P#p1.ibd
-t1#P#p2#TMP#.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_add_parts_3: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 8: crash_change_partition_4
-set @@debug_dbug= "+d,crash_change_partition_4";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_4: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_4: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p1#TMP#.ibd
-t1#P#p1.ibd
-t1#P#p2#TMP#.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_4: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 9: crash_change_partition_5
-set @@debug_dbug= "+d,crash_change_partition_5";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_5: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_5: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p1#TMP#.ibd
-t1#P#p1.ibd
-t1#P#p2#TMP#.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_5: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 10: crash_alter_partition_rename_to_backup
-set @@debug_dbug= "+d,crash_alter_partition_rename_to_backup";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_rename_to_backup: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_alter_partition_rename_to_backup: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0#TMP#.ibd
-t1#P#p1#TMP#.ibd
-t1#P#p1.ibd
-t1#P#p2#TMP#.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_rename_to_backup: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 11: crash_change_partition_rename_parts_1
-set @@debug_dbug= "+d,crash_change_partition_rename_parts_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_rename_parts_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_rename_parts_1: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0#TMP#.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1#TMP#.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2#TMP#.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_rename_parts_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 12: crash_alter_partition_rename_added_part
-set @@debug_dbug= "+d,crash_alter_partition_rename_added_part";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_rename_added_part: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_alter_partition_rename_added_part: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1#TMP#.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2#TMP#.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_rename_added_part: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 13: crash_change_partition_rename_parts_2
-set @@debug_dbug= "+d,crash_change_partition_rename_parts_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_rename_parts_2: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_rename_parts_2: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_rename_parts_2: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 14: crash_alter_partition_rename_drop_backup
-set @@debug_dbug= "+d,crash_alter_partition_rename_drop_backup";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_rename_drop_backup: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_alter_partition_rename_drop_backup: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_rename_drop_backup: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 15: crash_change_partition_6
-set @@debug_dbug= "+d,crash_change_partition_6";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_6: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_6: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_6: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 16: crash_change_partition_7
-set @@debug_dbug= "+d,crash_change_partition_7";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_7: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_7: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_7: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 17: crash_change_partition_8
-set @@debug_dbug= "+d,crash_change_partition_8";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_8: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_8: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-# d,crash_change_partition_8: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 18: crash_change_partition_9
-set @@debug_dbug= "+d,crash_change_partition_9";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_change_partition_9: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_change_partition_9: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_change_partition_9: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 19: crash_alter_partition_binlog_1
-set @@debug_dbug= "+d,crash_alter_partition_binlog_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_binlog_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_alter_partition_binlog_1: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_binlog_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 20: crash_alter_partition_binlog_2
-set @@debug_dbug= "+d,crash_alter_partition_binlog_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_alter_partition_binlog_2: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_alter_partition_binlog_2: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_alter_partition_binlog_2: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 21: crash_done_partition_1
-set @@debug_dbug= "+d,crash_done_partition_1";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_done_partition_1: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_done_partition_1: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_done_partition_1: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 3
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-master-bin.000001	#	Query	#	#	use `test`; ALTER TABLE t1 COALESCE PARTITION 2
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 22: crash_done_partition_2
-set @@debug_dbug= "+d,crash_done_partition_2";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_done_partition_2: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_done_partition_2: AFTER crash
-#sql-backup-4-t1.frm
-#sql-backup-4-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_done_partition_2: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 3
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-master-bin.000001	#	Query	#	#	use `test`; ALTER TABLE t1 COALESCE PARTITION 2
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 23: crash_fail_partition_1,fail_change_partition_5,
-set @@debug_dbug= "+d,crash_fail_partition_1,fail_change_partition_5,";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_fail_partition_1,fail_change_partition_5: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_fail_partition_1,fail_change_partition_5: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p1#TMP#.ibd
-t1#P#p1.ibd
-t1#P#p2#TMP#.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_fail_partition_1,fail_change_partition_5: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 24: crash_fail_partition_2,fail_change_partition_5,
-set @@debug_dbug= "+d,crash_fail_partition_2,fail_change_partition_5,";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_fail_partition_2,fail_change_partition_5: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_fail_partition_2,fail_change_partition_5: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#TMP#.ibd
-t1#P#p0.ibd
-t1#P#p1#TMP#.ibd
-t1#P#p1.ibd
-t1#P#p2#TMP#.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-# d,crash_fail_partition_2,fail_change_partition_5: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 25: crash_fail_partition_1,fail_change_partition_6,
-set @@debug_dbug= "+d,crash_fail_partition_1,fail_change_partition_6,";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_fail_partition_1,fail_change_partition_6: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_fail_partition_1,fail_change_partition_6: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_fail_partition_1,fail_change_partition_6: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-DROP TABLE t1;
-set @@debug_dbug= @save_dbug;
-# Crash-point 26: crash_fail_partition_2,fail_change_partition_6,
-set @@debug_dbug= "+d,crash_fail_partition_2,fail_change_partition_6,";
-RESET MASTER;
-CREATE TABLE t1 (a INT, b VARCHAR(64))
-ENGINE = 'InnoDB'
-PARTITION BY HASH (a) PARTITIONS 5;
-INSERT INTO t1 VALUES
-(1, "Original from partition p0"),
-(2, "Original from partition p0"),
-(3, "Original from partition p0"),
-(4, "Original from partition p0"),
-(11, "Original from partition p1"),
-(12, "Original from partition p1"),
-(13, "Original from partition p1"),
-(14, "Original from partition p1");
-# d,crash_fail_partition_2,fail_change_partition_6: BEFORE crash
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
-11	Original from partition p1
-12	Original from partition p1
-13	Original from partition p1
-14	Original from partition p1
-2	Original from partition p0
-3	Original from partition p0
-4	Original from partition p0
-ALTER TABLE t1 COALESCE PARTITION 2;
-# d,crash_fail_partition_2,fail_change_partition_6: AFTER crash
-#sql-shadow-t1.frm
-#sql-shadow-t1.par
-db.opt
-t1#P#p0#REN#.ibd
-t1#P#p0.ibd
-t1#P#p1#REN#.ibd
-t1#P#p1.ibd
-t1#P#p2#REN#.ibd
-t1#P#p2.ibd
-t1#P#p3#REN#.ibd
-t1#P#p4#REN#.ibd
-t1.frm
-t1.par
-# d,crash_fail_partition_2,fail_change_partition_6: AFTER recovery
-db.opt
-t1#P#p0.ibd
-t1#P#p1.ibd
-t1#P#p2.ibd
-t1#P#p3.ibd
-t1#P#p4.ibd
-t1.frm
-t1.par
-SHOW CREATE TABLE t1;
-Table	Create Table
-t1	CREATE TABLE `t1` (
-  `a` int(11) DEFAULT NULL,
-  `b` varchar(64) DEFAULT NULL
-) ENGINE=InnoDB DEFAULT CHARSET=latin1
- PARTITION BY HASH (`a`)
-PARTITIONS 5
-SELECT * FROM t1;
-a	b
-1	Original from partition p0
 11	Original from partition p1
 12	Original from partition p1
 13	Original from partition p1
