--source include/have_innodb.inc

CREATE TABLE t1 (a INT primary key, b int) ENGINE=InnoDB;
--error ER_CANT_DROP_FIELD_OR_KEY
ALTER TABLE t1 DROP FOREIGN KEY x, ALGORITHM=COPY;
--echo # Only Warning expected
ALTER TABLE t1 DROP FOREIGN KEY IF EXISTS x, ALGORITHM=COPY;
--error ER_CANT_DROP_FIELD_OR_KEY
ALTER TABLE t1 DROP KEY x, ALGORITHM=COPY;
ALTER TABLE t1 DROP KEY IF EXISTS x, ALGORITHM=COPY;
SHOW CREATE TABLE t1;
--error ER_CANT_DROP_FIELD_OR_KEY
ALTER TABLE t1 DROP CONSTRAINT x, ALGORITHM=COPY;
ALTER TABLE t1 DROP CONSTRAINT IF EXISTS x, ALGORITHM=COPY;
SHOW CREATE TABLE t1;
--error ER_CANT_DROP_FIELD_OR_KEY
ALTER TABLE t1 DROP FOREIGN KEY b;
#
# Column name is not same as foreign key constraint name
#
CREATE TABLE t2 (a int primary key, b int, foreign key (b) references t1(a)) engine=innodb;
--error ER_CANT_DROP_FIELD_OR_KEY
ALTER TABLE t2 DROP FOREIGN KEY b, ALGORITHM=COPY;
ALTER TABLE t2 DROP FOREIGN KEY IF EXISTS b, ALGORITHM=COPY;
DROP TABLE t2;
#
# These are fine
#
CREATE TABLE t2 (a int primary key, b int, foreign key b(b) references t1(a)) engine=innodb;
SHOW CREATE TABLE t2;
ALTER TABLE t2 DROP FOREIGN KEY b, ALGORITHM=COPY;
SHOW CREATE TABLE t2;
DROP TABLE t2;

# Cleanup
DROP TABLE t1;
