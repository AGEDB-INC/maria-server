--source include/have_debug.inc

--echo #
--echo # Start of 10.4 tests
--echo #

--echo #
--echo # MDEV-28727 ALTER TABLE ALGORITHM=NOCOPY does not work after upgrade
--echo #

CREATE TABLE t1 (a DOUBLE NOT NULL, KEY(a)) ENGINE=MyISAM;
ALTER TABLE t1 MODIFY a DOUBLE NOT NULL DEFAULT 10, ALGORITHM=NOCOPY;
DROP TABLE t1;

CREATE TABLE t1 (a DOUBLE NOT NULL, KEY(a)) ENGINE=MyISAM;
ALTER TABLE t1 MODIFY a DOUBLE NOT NULL DEFAULT 10, ALGORITHM=INSTANT;
DROP TABLE t1;

SET SESSION debug_dbug='+d,emulate_pre_mdev_20704';
CREATE TABLE t1 (a DOUBLE NOT NULL, KEY(a)) ENGINE=MyISAM;
SET SESSION debug_dbug='';
--error ER_ALTER_OPERATION_NOT_SUPPORTED
ALTER TABLE t1 MODIFY a DOUBLE NOT NULL DEFAULT 10, ALGORITHM=INSTANT;
DROP TABLE t1;

SET SESSION debug_dbug='+d,emulate_pre_mdev_20704';
CREATE TABLE t1 (a DOUBLE NOT NULL, KEY(a)) ENGINE=MyISAM;
SET SESSION debug_dbug='';
--error ER_ALTER_OPERATION_NOT_SUPPORTED
ALTER TABLE t1 MODIFY a DOUBLE NOT NULL DEFAULT 10, ALGORITHM=NOCOPY;
DROP TABLE t1;

--echo #
--echo # End of 10.4 tests
--echo #
